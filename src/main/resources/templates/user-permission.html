<!DOCTYPE html>
<html lang="en" data-layout="vertical" data-topbar="blue" data-sidebar="light" data-sidebar-size="lg"
    data-sidebar-image="none">


<!-- Mirrored from smarthr.dreamstechnologies.com/html/template/admin-dashboard.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 27 Jun 2024 06:05:21 GMT -->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Smarthr - Bootstrap Admin Template">
    <meta name="keywords"
        content="admin, estimates, bootstrap, business, corporate, creative, management, minimal, modern, accounts, invoice, html5, responsive, CRM, Projects">
    <meta name="author" content="Dreamstechnologies - Bootstrap Admin Template">
    <title>Dashboard - HRMS admin template</title>

    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.png">

    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

    <link rel="stylesheet" href="assets/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css">

    <link rel="stylesheet" href="assets/css/line-awesome.min.css">
    <link rel="stylesheet" href="assets/css/material.css">

    <link rel="stylesheet" href="assets/css/select2.min.css">

    <link rel="stylesheet" href="assets/css/bootstrap-datetimepicker.min.css">

    <link rel="stylesheet" href="assets/css/ckeditor.css">

    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .emplist:hover {
            background-color: rgb(255, 240, 245) !important;

        }

        .accordion-button:after {
            content: "";
            background-color: grey;
            border-radius: 0px;
            font-size: 0px;
            font-family: fontawesome;
            font-size: 0px;
            background-image: none !important;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
        }

        .roles-menu ul li a:hover {
            background-color: #ecedee;
            border-color: #00c5fb;
            color: black !important;
        }
    </style>
</head>

<body>

    <div class="main-wrapper">

        <div data-th-replace="~{base-template::component}"></div>


        <div class="page-wrapper">

            <div class="content container-fluid">

                <div class="page-header">
                    <div class="row align-items-center">
                        <div class="col">
                            <h3 class="page-title">User Role & Permission</h3>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/">Dashboard</a></li>
                                <li class="breadcrumb-item active">User Roles & Permissions</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="row">

                    <div class="col-sm-4 col-md-4 col-lg-4 col-xl-3">
                        <div class="">
                            <label class="" for="user">Search User</label>
                            <input class="form-control" type="text" id="user-input"
                                oninput="fetchEmployeeData(this.value)">
                        </div>
                        <div class="roles-menu">
                            <ul id="user-list">


                            </ul>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="mt-2">
                            <h2 class="text-center">Module Access</h2>
                        </div>
                        <div class="my-3" id="insertCode">


                        </div>
                    </div>
                </div>
            </div>


            <div id="add_department" class="modal custom-modal fade" role="dialog">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Add Role</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="input-block mb-3">
                                    <label class="col-form-label">Role Type <span class="text-danger">*</span></label>
                                    <input class="form-control" type="text">
                                </div>
                                <div class="submit-section">
                                    <button class="btn btn-primary submit-btn">Submit</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>


            <div id="edit_role" class="modal custom-modal fade" role="dialog">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Edit Role Type</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="input-block mb-3">
                                    <label class="col-form-label">Role Type<span class="text-danger">*</span></label>
                                    <input class="form-control" value="" type="text">
                                </div>
                                <div class="submit-section">
                                    <button class="btn btn-primary submit-btn">Save</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>


            <div class="modal custom-modal fade" id="delete_department" role="dialog">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div class="form-header">
                                <h3>Delete Role Type</h3>
                                <p>Are you sure want to delete?</p>
                            </div>
                            <div class="modal-btn delete-action">
                                <div class="row">
                                    <div class="col-6">
                                        <a href="javascript:void(0);" class="btn btn-primary continue-btn">Delete</a>
                                    </div>
                                    <div class="col-6">
                                        <a href="javascript:void(0);" data-bs-dismiss="modal"
                                            class="btn btn-primary cancel-btn">Cancel</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>





    <script src="assets/js/jquery-3.7.1.min.js" type="6a781e61f2492fe1cd92e39d-text/javascript"></script>

    <script src="assets/js/bootstrap.bundle.min.js" type="6a781e61f2492fe1cd92e39d-text/javascript"></script>

    <script src="assets/js/jquery.slimscroll.min.js" type="6a781e61f2492fe1cd92e39d-text/javascript"></script>

    <script src="assets/js/select2.min.js" type="6a781e61f2492fe1cd92e39d-text/javascript"></script>

    <script src="assets/js/moment.min.js" type="6a781e61f2492fe1cd92e39d-text/javascript"></script>
    <script src="assets/js/bootstrap-datetimepicker.min.js" type="6a781e61f2492fe1cd92e39d-text/javascript"></script>

    <script src="assets/js/layout.js" type="6a781e61f2492fe1cd92e39d-text/javascript"></script>
    <script src="assets/js/theme-settings.js" type="6a781e61f2492fe1cd92e39d-text/javascript"></script>
    <script src="assets/js/greedynav.js" type="6a781e61f2492fe1cd92e39d-text/javascript"></script>

    <script src="assets/js/app.js" type="6a781e61f2492fe1cd92e39d-text/javascript"></script>
    <script src="cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js"
        data-cf-settings="6a781e61f2492fe1cd92e39d-|49" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/assets/js/add-modules-erp.js"></script>

    <script>
        function fetchEmployeeData(inputValue) {
            const userList = document.getElementById('user-list');

            if (inputValue.trim().length > 0) {
                fetch(`/rest/employees-like?id=${encodeURIComponent(inputValue)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json(); // Convert response to JSON
                    })
                    .then(data => {
                        userList.innerHTML = ''; // Clear previous list items

                        if (Array.isArray(data) && data.length > 0) {
                            data.forEach(item => {
                                const li = document.createElement('li');
                                const a = document.createElement('a');
                                a.href = 'javascript:void(0);';
                                a.textContent = item.firstName + " " + item.lastName + "  [" + item.id + "]"; // Assuming 'name' is the property to display
                                a.onclick = () => {
                                    handleListItemClick(item.id); // Pass item ID to click handler
                                };
                                li.appendChild(a);
                                userList.appendChild(li);
                            });

                            const jsonData = JSON.stringify(data);
                            console.log(jsonData);
                        } else {
                            // No employees found
                            Swal.fire({
                                icon: 'info',
                                title: 'No Employees Found',
                                text: 'There are no employees with this ID.',
                                confirmButtonText: 'OK'
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Fetch error:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error fetching employee data',
                            text: 'Please try again later',
                            confirmButtonText: 'OK'
                        });
                        $('#insertCode').html("");
                    });
            } else {
                userList.innerHTML = '';
                $('#insertCode').html("");
                 // Clear the list if input is empty
            }
        }
        function handleListItemClick(employeeId) {
            // Remove 'active' class from all list items
            const listItems = document.querySelectorAll('#user-list li');
            listItems.forEach(item => {
                item.classList.remove('active');
            });

            // Perform AJAX call using employeeId
            $.ajax({
                url: '/get-module-By-employee/' + employeeId,
                type: 'GET',
                success: function (response) {

                    $('#insertCode').html(response);
                },
                error: function () {
                    console.error('Error fetching modules');
                }
            });
        }
        function saveEmployeePermission(moduleId, userId) {
            // Collect all checked and unchecked checkboxes
            const checkedPermissions = [];
            const uncheckedPermissions = [];

            // Select all checkboxes within the specified module accordion
            const checkboxes = document.querySelectorAll(`#${moduleId} input[type=checkbox]`);

            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {

                    checkedPermissions.push(parseInt(checkbox.value));
                } else {
                    uncheckedPermissions.push(parseInt(checkbox.value));
                }
            });
            console.log("user id", userId);
            console.log("Checked permissions:", checkedPermissions);
            console.log("Unchecked permissions:", uncheckedPermissions);

            // Make AJAX calls to assign and unassign role permissions
            // Example AJAX calls using fetch API
            fetch('/assign-and-unassign-user-permission', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    userId: userId,
                    checkedPermissionIds: checkedPermissions,
                    unCheckedPermissionIds: uncheckedPermissions
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log("data ", data);
                    if (data == true) {
                        // Show success message or SweetAlert
                        Swal.fire({
                            icon: 'success',
                            title: 'Permissions assigned successfully',
                            showConfirmButton: false,
                            timer: 1500
                        });
                    } else {
                        // Handle error scenario
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: data.message
                        });
                    }
                })
                .catch(error => {
                    console.error('Error assigning permissions:', error);
                });


        }



    </script>
</body>


</html>